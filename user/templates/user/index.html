{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Profile Section -->
            <div class="text-center mb-5">
                <img src="{% if user.profile.profile_pic %}{{ user.profile.profile_pic.url }}{% else %}{% static 'img/default-profile.png' %}{% endif %}" 
                     alt="Profile Picture" 
                     class="rounded-circle mb-3" 
                     style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #00CED1;">
                
                <h4 class="mb-3">{{ user.username }}</h4>
                <div class="d-flex justify-content-center gap-2">
                    <button type="button" class="btn btn-custom-gradient" data-bs-toggle="modal" data-bs-target="#changeUsernameModal">
                        Change Username
                    </button>
                    <button type="button" class="btn btn-custom-gradient" data-bs-toggle="modal" data-bs-target="#changePhotoModal">
                        Change Photo
                    </button>
                </div>
            </div>

            <!-- Settings Sections -->
            <div class="settings-section mb-4">
                <h5 class="mb-3" style="color: #00CED1;">Fitness Goals</h5>
                <div class="list-group">
                    <div class="list-group-item border-0 bg-light mb-2 rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Weight Loss</strong>
                                <p class="text-muted mb-0">Target: 10kg by December 2025</p>
                            </div>
                            <span class="badge bg-custom-gradient rounded-pill">In Progress</span>
                        </div>
                    </div>
                    <div class="list-group-item border-0 bg-light mb-2 rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Running</strong>
                                <p class="text-muted mb-0">Target: 5km in 30 minutes</p>
                            </div>
                            <span class="badge bg-custom-gradient rounded-pill">In Progress</span>
                        </div>
                    </div>
                    <div class="list-group-item border-0 bg-light mb-2 rounded">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Strength Training</strong>
                                <p class="text-muted mb-0">Target: 100kg bench press</p>
                            </div>
                            <span class="badge bg-custom-gradient rounded-pill">Not Started</span>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-custom-gradient mt-3" data-bs-toggle="modal" data-bs-target="#editGoalsModal">
                    Edit Goals
                </button>
            </div>

            <!-- Account Settings -->
            <div class="settings-section">
                <h5 class="mb-3" style="color: #00CED1;">Account</h5>
                <a href="{% url 'accounts.logout' %}" class="btn btn-custom-gradient">Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- Change Photo Modal -->
<div class="modal fade" id="changePhotoModal" tabindex="-1" aria-labelledby="changePhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #00CED1; color: white;">
                <h5 class="modal-title" id="changePhotoModalLabel">Change Profile Picture</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 'user.update_picture' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="profile_pic" class="form-label">Select a new profile picture</label>
                        <input type="file" class="form-control" id="profile_pic" name="profile_pic" accept="image/*" required>
                        <div class="form-text">Supported formats: JPG, PNG, GIF</div>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-custom-gradient">Update Photo</button>
                    </div>
                </form>
                {% if user.profile.profile_pic %}
                    <hr>
                    <div class="text-center">
                        <form action="{% url 'user.remove_picture' %}" method="POST" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-custom-gradient" onclick="return confirm('Are you sure you want to remove your profile picture?')">
                                Remove Current Photo
                            </button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Change Username Modal -->
<div class="modal fade" id="changeUsernameModal" tabindex="-1" aria-labelledby="changeUsernameModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #00CED1; color: white;">
                <h5 class="modal-title" id="changeUsernameModalLabel">Change Username</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 'user.update_username' %}" method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="username" class="form-label">New Username</label>
                        <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-custom-gradient">Update Username</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Goals Modal -->
<div class="modal fade" id="editGoalsModal" tabindex="-1" aria-labelledby="editGoalsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #00CED1; color: white;">
                <h5 class="modal-title" id="editGoalsModalLabel">Edit Fitness Goals</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 'user.update_goals' %}" method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="goal1" class="form-label">Weight Loss Goal</label>
                        <input type="text" class="form-control" id="goal1" name="goal1" value="10kg by December 2025">
                    </div>
                    <div class="mb-3">
                        <label for="goal2" class="form-label">Running Goal</label>
                        <input type="text" class="form-control" id="goal2" name="goal2" value="5km in 30 minutes">
                    </div>
                    <div class="mb-3">
                        <label for="goal3" class="form-label">Strength Goal</label>
                        <input type="text" class="form-control" id="goal3" name="goal3" value="100kg bench press">
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-custom-gradient">Save Goals</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}